
<html>

   <head>
      <title>Products</title>
	  <meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
<link rel="stylesheet" href="custom.css">
   </head>
   
  
   
   <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
<script>
$(document).ready(function(){
$('#ajax-loader').hide();
    $.ajax({
		type: "GET",
		url:"http://localhost:5000/products",
		beforeSend: function(){
								$('#ajax-loader').show();
								
							},
		complete: function(){
							$('#ajax-loader').hide();
							
						},
		
		success: function(data){ 
            if(data){
			
                var len = data.length;
                var txt = "";
                if(len > 0){
                    for(var i=0;i<len;i++){
                        if(data[i]._id && data[i].Category && data[i].MainCategory && data[i].Price){
                            txt += "<tr><td class='prodId'><input type='text'  data-default="+data[i]._id+" value="+data[i]._id+" disabled=true>  </input></td><td class='category' ><input  type='text' data-default="+data[i].Category+" value="+data[i].Category+" disabled=true>  </input></td><td class='mainCategory' ><input  type='text'  data-default="+data[i].MainCategory+" value="+data[i].MainCategory+" disabled=true>  </input></td><td class='price'><input   type='number' data-default="+data[i].Price+" value="+data[i].Price+" disabled=true>  </input></td><td ><span class='updtbtn'><i class='w3-xlarge fa fa-edit'></i></span><span class='saveBtn' style='display:none'><i class='w3-xlarge fa fa-save' ></i></span><span class='cancelBtn' style='display:none'><i class='w3-xlarge fa fa-close cancel'></i></span></td><td><span class='delBtn' ><i class='w3-xlarge fa fa-trash' ></span></td><td><input type=button value='Update' class='simpleupdate'</td></tr>";
                        }
                    }
                    if(txt != ""){
                        $("#table").append(txt);
                    }
                }
            }
        },
		error: function() {
			alert('Not OKay');
		}
	});
	
	 
    
});


$(document).on('click', '.simpleupdate', function(e) { 
    try{
     var prodId="";
		$(this).parent().prevAll('.prodId').each(function() {
			$(this).find('input').each(function () {
			 prodId=this.value;	
			
				})
			});
		window.location='\\update?'+prodId;
			
		}
    catch(err){alert(err);}
});


$(document).on('click', '.updtbtn', function(e) { 
    try{
      
			/*$(this).prevAll().each (function() {
				this.setAttribute("contenteditable", true);
				});*/
				
		/*	$(this).parent().prevAll().each (function() {
				this.setAttribute("contenteditable", true);
				});*/
				
				
			$(this).parent().prevAll().each (function() {
				field=this.className;
				$(this).find('input').each(function () {
				if (field !='prodId')
				 {
					this.disabled=false;
					}
					})
				});
				  
			$(this).hide();
			$(this).siblings('.saveBtn').show();
			$(this).siblings('.cancelBtn').show();
			
			
			
		}
    catch(err){alert(err);}
});

$(document).on('click', '.cancelBtn', function(e) { 
    try{
      	
			/*$(this).parent().prevAll().each (function() {
				this.setAttribute("contenteditable", false);
				this.innerHTML="asd";
				});*/
				
				$(this).parent().prevAll().each (function() {
				$(this).find('input').each(function () {
				$(this).val($(this).attr("data-default"));
					this.disabled=true;
					})
				});
				
			$(this).hide();
			$(this).siblings('.saveBtn').hide();
			$(this).siblings('.updtbtn').show();
		
		}
    catch(err){alert(err);}
});

$(document).on('click', '.saveBtn', function(e) { 
    try{
      	
			$(this).parent().prevAll().each (function() {
				this.setAttribute("contenteditable", false);
				});
				
			$(this).hide();
			$(this).siblings('.cancelBtn').hide();
			$(this).siblings('.updtbtn').show();
			
			var data={};
			
			
			$(this).parent().prevAll().each(function() {
			var field = this.className;
			//alert(field);
			$(this).find('input').each(function () {
			 data[field]=this.value;	
			
				})
			});
			
			//alert(JSON.stringify(data));
			
			$.ajax(
			{
				url : "http://localhost:5000/update",
				type: "POST",
				data : data,
				beforeSend: function(){
								$('#ajax-loader').show();
								
							},
				complete: function(){
							$('#ajax-loader').hide();
							
						},
				success:function(result) 
				{
					alert(JSON.stringify(result.message));
					window.location="http://localhost:5000/home";
					 //$("#result").html(JSON.stringify(data.message));
				},
				error: function(jqXHR, textStatus, errorThrown) 
				{
				alert(textStatus);
				}
			});
		
	//});
			
			
			
		
		}
    catch(err){alert(err);}
});


$(document).on('click', '.delBtn', function(e) { 
    try{
		var prodId="";
		$(this).parent().prevAll('.prodId').each(function() {
			$(this).find('input').each(function () {
			 prodId=this.value;	
			
				})
			});
			
			//prodId=$(this).parent().prevAll('.prodId').find('input').value;
			//alert(prodId);
			
		var userchoice =confirm("You are attempting to delete product: "+prodId+ "?\nClick 'Ok' to proceed.");
		
		if (userchoice == true)
		{
			
			$.ajax({
					type: "DELETE",
					url:"http://localhost:5000/delete/?prodId="+prodId,
					
					success: function(data)
					{  
						if(data)
						{
							
							alert(JSON.stringify(data));
							window.location.reload();
						}
					
					},
					error: function() {
						alert('Some problem occured during deletion.');
					}
		
					});
		}
      	
			
		
		}
		catch(err)
		{
			alert(err);
		}
			
		 
});

$(document).on('click', '.addBtn', function(e) { 
    try{
      	
		window.location='\\create';
		
		}
    catch(err){alert(err);}
});




</script>

   <body>
   <div id="ajax-loader" class='spinner' style='display:None'>
			<img src="spinner.gif" class="img-responsive"  />
				</div>
      <table width = "100%" border = "0">
         
         <tr>
            <td colspan = "2" bgcolor = "#b5dcb3">
               <h1>Sample Products Page</h1>
            </td>
         </tr>
         <tr valign = "top">
           
            
            <td bgcolor = "#eee" width = "125" height = "500">
              
			  
			  <div class="result"></div>
			  <table id="table" border="1">
				<tr>
					<th width="20%">Product Id</th>
					<th width="20%">Category</th>
					<th width="25%">Main Category</th>
					<th width="15%">Price</th>
					<th colspan=3></th>
					
					
				</tr>
				
				</tr>
			</table>
			
			<input type="submit" value="Add a product" class="addBtn">
			
			

			  
            </td>
         </tr>
         <tr>
            <td colspan = "2" bgcolor = "#b5dcb3">
               <center>
                  
               </center>
            </td>
         </tr>
         
      </table>
	  
	  
   </body>

</html>